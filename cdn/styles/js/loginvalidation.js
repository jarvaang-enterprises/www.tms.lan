var current_fs,next_fs,previous_fs,left,opacity,scale,old_width=0,new_width,animating,ref=null;$("document").on("load",function(a){null!=window.cont&&(ref=window.cont,log(ref))});$("#email").val("");$(".next").click(function(){current_fs=$(this).parent();var a=$("fieldset").index(current_fs);if(0==a){$("#password").val("");$("#msg").text("");var c=$("#email").val();checkEmail(c,function(b){1==b&&(next_fs=current_fs.next(),animate(next_fs))})}1==a&&(next_fs=current_fs.next(),animate(next_fs))});
function animate(a){log("Animating...");if(animating)return!1;animating=!0;$(".progressbar .bar").animate({height:"5px",width:old_width+145});a.show();$(".login").animate({height:"370px"});current_fs.animate({opacity:0},{step:function(c,b){left=-10*c+"%";opacity=1-c;current_fs.css({transform:"scale("+scale+")"});a.css({left:left,opacity:opacity});a.css({"margin-top":"10px","margin-left":"10px"})},duration:200,complete:function(){current_fs.hide();animating=!1},easing:"easeInOutBack"})}
$(".previous").click(function(){if(animating)return!1;animating=!0;current_fs=$(this).parent();previous_fs=$(this).parent().prev();$(".progressbar .bar").animate({width:"1%"});previous_fs.show();$(".login").animate({height:"300px"});$("#error_msg").text("");current_fs.animate({opacity:0},{step:function(a,c){scale=.8+.2*(1-a);left=20*(1-a)+"%";opacity=1-a;current_fs.css({left:left});previous_fs.css({transform:"scale("+scale+")",opacity:opacity})},duration:200,complete:function(){current_fs.hide();
animating=!1},easing:"easeInOutBack"})});checkAuthentication();
function checkAuthentication(){var a=$("#msform").get(0);$(".submit").on("click",function(c){c.preventDefault();$.ajax({url:"/actions/checkAuth.php",type:"POST",data:new FormData(a),contentType:!1,cache:!0,dataType:"JSON",processData:!1,success:function(b){"SHOW_ERROR"==b.action?($(".login").animate({height:"410px"}),$("#password").css({"border-color":"#dd4b39"}),$("#password").focus(),$("#msg").css({color:"#dd4b39","text-align":"left"}),$("#msg").text(b.msg)):"SHOW_SUCCESS"==b.action&&(null!=ref?
window.location.href=ref:1==b.level?window.location.href="/man/":2==b.level?window.location.href="/csh/":3==b.level?window.location.href="/trn/":4==b.level&&(window.location.href="/cli/"))},error:function(){log("Errors occured: In authentication.");log("window.location.href ='"+ref+"'")}})})}
function checkEmail(a,c){$.ajax({url:"/actions/checkEmail.php",type:"POST",dataType:"JSON",data:"user="+a,success:function(b){if("SHOW_ERROR"==b.action){$(".login").animate({height:"330px"});$("#email").css({"border-color":"#dd4b39"});$("#email").focus();$("#error_msg").text(b.error_msg);var a=0}else"SHOW_SUCCESS"==b.action&&($("#img").html(b.image),$("#userName").text(b.fName+" "+b.lName),$("#userEmail").text(b.email),a=1);c(a)},error:function(){log("Error occured: In checking email. "+a)}})};
